\section{The SPC Relational Algebra}
\label{sec:ra}

%\TODO{relational algebra}
%\TODO{add syntax definition}
\maybeAdd{add type system}
%\TODO{add examples with tables}
\maybeAdd{maybe add semantics later on}
Having introduced relational databases we now shift gears into querying
these databases, that is, extracting information from tables.
For almost all relational query languages, the result of a query 
is a table called $\mathit{result}$. 
%
We base our variational query language on the SPC relational algebra.
Three primitive operators form the SPC algebra: \emph{selection}, \emph{projection},
and \emph{cross-product} (or Cartesian product)~\cite{AliceBook}.
We introduce these operators through \exref{ra} by stating an intent and then
building up a query to extract the information required by the intent. 

\begin{example}
\label{eg:ra}
Consider the database instance given in \tabref{rdb}. We want to get a list
of employees (by their names) whose salary is more than 65000 dollars. 
As the first step, we use the selection operator to get the tuples for all jobs with salaries that 
are more than 65000 dollars.\\
%
%\begin{equation*}
\centerline{
\ensuremath{
{\pQ_1} = \sigma_{\salary \ge 65000} (\job)
%\end{equation*}
}}
%
\noindent
A sample of the results returned by the query ${\pQ_1}$ is given in \tabref{ra1}.
Next a set of 
 tuples is created by taking the cross-product of ${\pQ_1}$
and \empacct.\\
%
%\begin{equation*}
\centerline{
\ensuremath{
{\pQ_2} = {\pQ_1} \times \empacct
%\end{equation*}
}}
%
\noindent
A sample of the results returned by the query ${\pQ_2}$ is given in \tabref{ra2}.
However, looking closely at these results there is no connection between an employee
in the \empacct\ relation and their salary in the \job\ relation. Thus, we have to perform 
another selection to connect each employee with their title. \\
%
%\begin{equation*}
\centerline{
\ensuremath{
{\pQ_3} = \sigma_{\empacct.\titleatt=\job.\titleatt} ({\pQ_2})
%\end{equation*}
}}
%
\noindent
A sample of the results returned by the query ${\pQ_3}$ is given in \tabref{ra3}.
At this point, we are only interested in two attributes, that is, \name\ and \salary.
Thus, we use projection to discard the unneeded columns.\\
%
%\begin{equation*}
\centerline{
\ensuremath{
{\pQ_4} = \pi_{\name, \salary} ({\pQ_3} )
%\end{equation*}
}}
%
A sample of the results returned by the query ${\pQ_4}$ is given in \tabref{ra4}.
\end{example}

\input{tables/rares}

The relational algebra that we use also includes standard set operations, a join 
operation, and an empty relation. The syntax is defined in \figref{rel-alg}.
%
The set operations, union and intersection, require two subqueries to have the same relation schema
and simply applies the corresponding operation, either union or intersection, to the tuples returned by
the subqueries.
%For example, if we have $\pRel_1(\pAtt_1, \pAtt_2)$ with 
%tuples $\{(1,2)(3,4)\}$
%and $\pRel_2(\pAtt_1, \pAtt_2)$ with tuples $\{(1,2),(5,6) \}$
%then $\pRel_1 \cup \pRel_2 $ returns the tuples $\{(1,2), (3,4), (5,6)\}$.
%
The \emph{join} operation is equivalent to selection applied to cross-product, that is,
$\pQ_1 \bowtie_{\pCond} \pQ_2 = \vSel [\pCond] {(\pQ_1 \times \pQ_2)}$.
For example, ${\pQ_3}$ in \exref{ra} can be rewritten as\\
\centerline{
\ensuremath{
\VVal {{\pQ_3}} = \left(\sigma_{\salary \ge 65000} \left(\job\right)\right) \bowtie_{\empacct.\titleatt=\job.\titleatt} \empacct
}}.
%joins two subqueries based on a condition and
\noindent
Throughout our examples, omitting the condition of join  implies it is a \emph{natural join},
that is, join on the shared attribute of the two subqueries.
For example, $\VVal {{\pQ_3}}$ can be rewritten using the natural join\\
\centerline{
\ensuremath{
\VVVal {{\pQ_3}} =  \left(\sigma_{\salary \ge 65000} \left(\job\right)\right) \bowtie \empacct
}}.

\input{formulas/rel-alg-def}

We also extend relational algebra such that projection of an empty set of
attributes is a valid query that returns an empty set of tuples. We define the
\emph{empty} query \empPRel\ as shorthand for projecting an empty set of
attributes, that is, $\empPRel = \pi_{\{\}} \pQ$.
%
Note that we do not extend the notation of using underline for relational algebra
operators. Instead, relational algebra operators are overloaded and are used
as both plain relational and variational operators. It should be clear from
context when an operation is variational or not. 


Although we do not consider renaming of queries in the formal definition of 
relational algebra we do support this in our implementation. Furthermore, we use it
to rename subqueries of our examples to make them easier to understand. 
For example, query $\VVVal {{\pQ_3}}$ can be written as:
\begin{align*}
\VVVal {{\pQ_3}} &= \underline{temp} \bowtie \empacct\\
\underline{temp} &\leftarrow  \sigma_{\salary \ge 65000} \left(\job\right)
\end{align*}
\noindent
Making this renaming explicit is necessary to avoid names conflicting in some cases.




