\section{The Formula Choice Calculus}
\label{sec:fcc}


%To account for variation, VRA combines relational algebra (RA) with 
%\emph{choices}~\cite{EW11tosem,HW16fosd,Walk13thesis}.
%%\point{choice.}
%A choice $\chc{\elem_1,\elem_2}$ consists of a feature expression \dimMeta, called
%the \emph{dimension} of the choice, and 
%two \emph{alternatives} $\elem_1$ and $\elem_2$. For a given configuration \config, 
%the choice $\chc{\elem_1, \elem_2}$ can be replaced by $\elem_1$ if \dimMeta\
%evaluates to \t\ under configuration \config, (i.e., \fSem{\dimMeta}),
%or $\elem_2$ otherwise. 

The second approach we use to incorporate variation into queries is
the formula choice calculus~\cite{HW16fosd} which is an extension of 
the choice calculus~\cite{Walk13thesis,EW11tosem}. 
%
The choice calculus is a metalanguage for
describing variation in programs and its elements such as data 
structures~\cite{Walk14onward,EWC13fosd}.
In the choice calculus, variation is represented in-place as
choices between alternative subexpressions. For example, 
the variational expression 
$\mathit{expr} = \chc [\A] {1,2} + \chc [\B] {3,4} + \chc [\A] {5,6}$
 contains three choices.
Each choice has an associated \emph{dimension}, which is a boolean
variable equivalent to a feature and is used to
synchronize the choice with other choices in different parts
of the expression. For example, expression $\mathit{expr}$ contains
two dimensions, $\A$ and $\B$, and the two choices in dimension
$\A$ are synchronized. Therefore, the variational expression
$\mathit{expr}$ represents four different plain expressions, depending
on whether the left or right alternatives are selected from each
dimension. Assuming that dimensions may be set to boolean values
where \t\ indicates the left alternative and \f\ indicates the
right alternative, we have: 
%(1) $1+3+5$, when $A$ and $B$ are \t,
%(2) $1+4+5$, when $A$ is \t\ and $B$ is \f,
%(3) $2+3+6$, when $A$ is \f\ and $B$ is \t,
%and (4) $2+4+6$, when $A$ and $B$ are \f.
\begin{alignat*}{1}
\chc [\A] {1,2} + \chc [\B] {3,4} + \chc [\A] {5,6} &=
\begin{cases}
  1+3+5,& \A =\t, \B = \t\\
  1+4+5,& \A =\t, \B = \f\\
  2+3+6,& \A =\f, \B = \t\\
  2+4+6,& \A =\f, \B = \f
\end{cases}
\end{alignat*}
%
\noindent
The formula
choice calculus extends the choice calculus 
by allowing dimensions to be propositional formulas~\cite{HW16fosd}. For example,
the variational expression $\VVal {\mathit{expr}} = \chc [\A \vee \B] {1,2} + \chc [\B] {3,4} + \chc [\A] {5,6}$ represents
four plain expressions: 
%(1) $1$, when $\A \vee \B$ evaluates to \t\
%and (2) $2$, when $\A \vee \B$ evaluates to \f. More explicitly, we have:
\begin{alignat*}{1}
\chc [\A \vee \B] {1,2} + \chc [\B] {3,4} + \chc [\A] {5,6}&=
\begin{cases}
  1+3+5,& \A =\t, \B = \t\\
  1+4+5,& \A =\t, \B = \f\\
  1+3+6,& \A =\f, \B = \t\\
  2+4+6,& \A =\f, \B = \f
\end{cases}
\end{alignat*}


