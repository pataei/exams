\section{Variation Space in a Variational Database Framework}
\label{sec:varspace}

\TODO{have to revise}
\TODO{define oplus in fig as syntactic sugar.}

%\point{using a feature set to represent variability within a context.}
To account for variability in a database we need to 
encode it.
%
%The first challenge of incorporating variability into a database
%is to represent variability. 
%
To encode variability we introduce a \emph{feature space} \fSet\ as 
a closed set of boolean variables. 
A feature \ensuremath{\fName \in \fSet} can be enabled (i.e., \fName = \t) or disabled (\fName = \f).
Features capture the variation in a given variational scenario.
%first organize the configuration space into
%a set of features \fSet.
%, denoted by \fSet.
%
%we require a \emph{set of features}, denoted by \fSet, 
%appropriate for the context that the database is used for.
%
For example, in the context of schema evolution, features can be generated from version 
numbers (e.g. features \vOne\ to \vFive\ and \tOne\ to \tFive\ in the 
motivating example, \tabref{mot}); for SPLs, 
the features can be adopted from the SPL feature set (e.g. the \edu\ feature in
our motivating example, \tabref{mot}); and 
for data integration, the features can be representatives of resources.  
%For simplicity, the set of features is assumed to be closed and features are
%assumed to be boolean variables, however, it is easy to extend them
%to multi-valued variables that have finite set of values.
% and without loss of generality, 
%features are assumed to be boolean variables, although, it is easy to extend them
%to multi-valued variables. 
%A feature \ensuremath{\fName \in \fSet} can be enabled (i.e., \fName = \t) or disabled (\fName = \f).
%\point{configuration.}
%Assuming that all the features by default are set to \prog{false},
%enabling some of them specifies a variant. 

Features describe local points of variation in a database.
%, i.e,
%in \fSet\ 
%are used to 
%they indicate which parts of the database are present conditionally.
%of a variational entity within the database 
%are different 
%among different variants. 
Thus, enabling or disabling all
the features 
%in \fSet\ 
produces a particular database \emph{variant} where
%of the entity in which 
all variation has been removed. 
%Enabling or disabling all features of \fSet\ specifies a non-variational \emph{variant}
%that can potentially be generated by \emph{configur}ing its variational counterpart 
%with the variant's \emph{configuration}.
%Hence, to specify a variant
%we define a function, called 
A \emph{configuration} is a \emph{total} function
that maps every feature in the feature set to a boolean value.
%By definition, a configuration is a \emph{total} function,
%i.e., it is defined for \emph{all} features in the feature set. 
%For brevity, 
We represent a configuration  by the set of enabled features.
%which represents a variant. 
%\ensure{make sure referring to a variant can be done by the set of enabled features. HERE!}
For example, in our motivating scenario, the configuration \ensuremath{
\setDef {\vTwo,\tThree,\edu}
}
represents a database variant where only features \vTwo, \tThree, and \edu\ are enabled.
This database variant contains relation schemas in the yellow cells of \tabref{mot}.
%of the
%employee and education sub-schemas associated with \vTwo\ and
%\tThree\ in \tabref{mot}, respectively.
%For brevity, 
We refer to a variant with configuration \config\ as variant \config, e.g.,
%For example, 
variant \setDef {\vTwo,\tThree,\edu} refers to the variant
with configuration \setDef {\vTwo,\tThree,\edu}.
%and education sub-schema associated with \tThree\ in \tabref{mot}.

%\point{represent variability in db by prop formula of features, called feature expression.}
%Having defined a set of features, we need to incorporate them into the database.
%To encode features in the database, we construct propositional formulas of features
%such that the formula evaluates to \t\ for a set of configurations. 
When describing variation points in the database, we need to 
refer to subsets of the configuration space. We achieve this by 
constructing propositional formulas of features.
Thus, 
such a propositional formula defines a condition that holds for 
a subset of configurations and their corresponding variants. 
%
%describing the condition where one or more variants are present,
%i.e., assigning features to their values defined in variant's configuration and 
%evaluating the propositional formula results in \prog{true}.
%
For example,
the propositional formula $\neg \edu$ represents all variants of our
motivating example that do not 
have the education part of the schema, i.e., variant schemas of the 
left schema column. 

We call a propositional formula of features a \emph{feature expression} and define
it formally in \figref{fexp-def}. 
%\figref{fexp-def} defines the syntax of feature expressions.
The evaluation function of feature expressions 
$\fSem \dimMeta : \ffSet \to \confSet \to \bSet$ simply substitutes each
feature \fName\ in the expression \dimMeta\ with its boolean value 
set in the given configuration \config\ and then
simplifies the propositional formula to a boolean value.
%  evaluates the 
%feature expression \dimMeta\ w.r.t. the configuration \config.
%and defined in
%our technical report~\cite{vldbArXiv}, 
%and defined in \appref{fexp},
%evaluates feature expression \dimMeta\ under configuration \config,
%also called \emph{configuration of feature expression \dimMeta\ under \config}. 
For example, assuming that 
\ensuremath{\fSet = \setDef{\A, \B}}
 $\fSem [\{\A\}] {\A \vee \B} = \t \vee \f = \t$, however,
%which states that the feature expression
%$\A \vee \B$ evaluates to \t\ w.r.t. configuration that only enables $\A$, however,
$\fSem [\{\}] {\A \vee \B} = \f \vee \f = \f$.
%, where the empty set indicates neither \A\ nor \B\
%are enabled.
%which states that the same feature expression evaluates
%to \f\ when neither $\A$ nor $\B$ are enabled.
Additionally, we define the binary \emph{equivalence ($\equiv$)} relation and
the unary \emph{satisfiable (sat)} and \emph{unsatisfiable (unsat)}
relations over feature expressions in \figref{fexp-def}.
%
% some of the functions needed over feature
%expressions:
%1) \emph{equivalence} of two feature expressions, 
%\ensuremath{\dimMeta_1 \equiv \dimMeta_2}
%and
%2) \emph{satisfiability} of a feature expression, 
%\ensuremath{\sat \dimMeta}.
%However, we define the evaluation of feature expressions and functions over them
%in \appref{fexp}.
%We define two functions over feature expressions, as shown in \figref{fexp-def}:
%1) \emph{satisfiability}: feature expression \dimMeta\ is \emph{satisfiable} if there 
%exists configuration \config\ s.t. \fSem \dimMeta = \t\
%and 2) \emph{tautology}: feature expression \dimMeta\ is a \emph{tautology} if  
%for all valid configurations we have: \fSem \dimMeta = \t.

%\point{annotating elements of database with feature expressions.}
To incorporate feature expressions into the database,
we \emph{annotate/tag} database elements (including attributes, relations, and tuples) 
with feature expressions. An \emph{annotated element} \elem\ with feature expression \dimMeta\
is denoted by \annot \elem. 
%The feature expression \dimMeta\ represents
%the set of configurations where their variants contain element \elem\ because
%
The feature expression attached to an element is called a \emph{presence condition}
since it determines the condition (set of configurations) under which the element is present.
\getPC {\annot \elem} returns the presence condition of the variational element
\annot \elem.
For example, the
annotated number $\annot [\A \vee \B] 2$ is present in variants
\setDef \A, \setDef \B, 
\ensuremath{\setDef {\A, \B}}
% with a configuration
%that enables either $\A$ or $\B$ or both
but it does not exist in variant \setDef {}.
%variants that disable both $\A$ and $\B$.
Here, $\getPC {\annot [\A \vee \B] 2} = \A \vee \B$.

%\point{relationship between features is captured by a propositional formula, called feature model.} 
No matter the context, features often have a relationship with each other that
constrains configurations. For example, only one of the temporal features of $\vOne - \vFive$
can be \t\ for a given variant.
This relationship is captured by a feature expression, called a \emph{feature model} and
denoted by \fModel,
which restricts the set of \emph{valid configurations}:
if configuration \config\ violates the relationship then 
%evaluating the feature model \fModel\
%under this configuration evaluates to \f: 
it follows from the \fSem . definition that \fSem \fModel = \f.
For example, the restriction that at a given time only one of temporal features $\vOne - \vFive$
can be enabled is represented by:
%the feature expression:
\ensuremath{
\vOne \oplus \vTwo \oplus \vThree \oplus \vFour \oplus \vFive
},
where $\A \oplus \B \oplus \ldots \oplus \fName_n$ is syntactic sugar for $(\A \wedge \neg \B \wedge \ldots \wedge \neg \fName_n) \vee (\neg \A \wedge \B \wedge \ldots \wedge \neg \fName_n) \vee (\neg \A \wedge \neg \B \wedge \ldots \wedge \fName_n)$
, i.e., features are mutually exclusive.
%multiple features cannot be enabled simultaneously.
%$\left(\vOne \wedge \neg \left(\vTwo \vee \hdots \vee \vFive \right) \right)
%\vee \left(\vTwo \wedge \neg \left(\vOne \vee \vThree \vee \vFour \vee \vFive \right) \right) 
%\vee \hdots 
%\vee \left(\vFive \wedge \neg \left(\vOne \vee \hdots \vee \vFour \right) \right)$.
%Note that this is not the feature model for the entire motivating example.



\input{formulas/fexpDef}
\input{formulas/fexpEval}


