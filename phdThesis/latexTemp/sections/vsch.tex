\section{Variational Schema}
\label{sec:vsch}

In this section, we define how variation is encoded at the schema level. We first 
present an example that
 illustrates how relational databases fail to encode
variation at the schema level and how we can express variation in their schemas.
Recall from \secref{rdb} that the schema of a database is essentially its type.
This is also the case for variational databases, except that the components 
of the schema are variational.
The  variation in a variational schema states the condition under which its relations and
attributes exist.
%
For example, consider the \empbio\ relation schema associated with 
variant \vThree\ of our motivating example shown in \tabref{mot-basic}.
\tabref{empbio-v3} shows a corresponding relational table of this relation. 
% 
Note that the relation \empbio\ changes in variants that enable either \vFour\ or \vFive\
and \tabref{empbio-v4} and \tabref{empbio-v5} show their corresponding relational tables, 
respectively.
%
The variational relation schema of \empbio\ captures this variation
in \tabref{empbio-vsch} by annotating the relation and each of its attributes with
 a feature expression indicating which configurations they exist in.
%This table can be interpreted as \empbio\ is present in variants that enable 
%at least one of \vThree, \vFour, and \vFive. Then, 
%
The feature expressions written in blue above the attributes and the relation name
are their presence conditions. 
For example, the feature expression $\vThree \vee \vFour \vee \vFive$ indicates that the
\empbio\ table is present for variants that enable one of \vThree--\vFive. 
%
The three attributes 
\empno, \sex, and \birthdate\ are present in all variants where the \empbio\ relation exists,
%exists in the relation \empbio\ no matter what as long as
%\empbio\ exists in a variant, 
so their presence conditions are \t. 
However, the \name\ attribute is only present in variants
that enable \vFour\ while attributes \fname\ and \lname\ are only present in variants
that enable \vFive.

\input{tables/vsch}

Furthermore, the existence of the variational relation \empbio\ and its attributes 
relies on the existence of the entire variational database which is captured by
the feature model of the database. Remember that the feature model is the
presence condition of the variational database as a whole. 
%
The hierarchy of presence condition sometimes simplifies the presence conditions.
For example, assuming that only one of the \vThree--\vFive\ can be enabled for a variant at a time, 
the \empbio\ variational table shown in \tabref{empbio-vsch} can be simplified to the 
variational table shown in \tabref{empbio-vsch-comp}. 
%consider table empbio in v3 but that's different than empbio for v4 and v5. so we add varition now. 
%
%The \empbio\ variational table itself exists when: first, the database is present; second,  
%at least one of the \vThree--\vFive\ features are enabled.
%The database is present for variants that satisfy its presence condition. 
%We discuss this more in \exref{vsch-mot}.
%
Note that \tabref{empbio-vsch-comp} and \tabref{empbio-vsch} focuse 
only on the relation schema and does not 
include the variation at the content level.%
\footnote{\tabref{empbio-vtab} includes
the variation at the content level.} 
We discuss the encoding of variation at the content level in \secref{vtab}.
%
\wrrite{add an example that shows reuse of tuples.
eric's comment:
there's no reason that each row must be in eactly one of v3--v5. you could have rows where the name is represented both in the name column and fname lname. the rows could be in any v1--v5.

in fact, this might make the utility of VDBs more obvious since the same data is available structured in different ways}

\input{tables/vsch-comp}


\figref{vsch} gives a formal definition of variational schemas. Variational schemas build
on plain relational schemas defined in \secref{rdb}.
%Now we switch to the formal definition of a variational schema, defined in \figref{vsch}.
%Note that our assumption for relational databases also holds for variational databases,
%that is, we assume a countably infinite set of \attnametype\ of attributes is fixed; we assume
%there is a total order $\leq_\attnametype$ on \attnametype; for any set of attributes \vAttList,
%we assume that elements of \vAttList are written according to $\leq_\attnametype$; for 
%theoretical developments we assume the same domain of values for all attributes; 
%we assume a countably infinite set \relnametype\ of relation names disjoint from \attnametype.
%
A variational schema captures variation in the structure of a database by indicating which attributes and relations are included or excluded in which variants.
%
%\point{using annotated elements to show variability in schema.}
%Variation can exist in the structure of data, i.e., the schema.
%As motivated in \secref{mot}, schema variations include/exclude relations/attributes. 
To this end, we annotate attributes, relations, and the schema itself with
feature expressions,
which describe the conditions under which each is present.
%
A \emph{variational relation schema} (\emph{v-relation schema}), \vRelSch, is a relation name
with an annotated variational set of attributes,
%\centerline{
$\synDef {\vRelSch} \vRelSchSet \eqq \vRelDef$.
%}
The presence condition of the variational relation schema, \dimMeta, determines in what
variants of the database the relation itself is present.
%A \emph{variational attribute set}, \vAttList, is a variational set of attributes.
%%i.e.,
%%$\synDef \vAttList \vAttSet \eqq \optAtt, \vAttList \myOR \empAtt$,
%%where \empAtt\ denotes an empty attribute. 
%%\exref{vsch} illustrates creating
%%a variational schema.
%
A \emph{variational schema} (\emph{v-schema}) is an annotated set of variational relation 
schemas,
%\centerline{ 
$\synDef \vSch \vSchSet \eqq \vSchDef$.
%} 
The presence condition of the entire variational schema, \dimMeta, is the VDB's feature
model, which provides a top-level constraint on the set of valid
configurations, as described in \secref{encode-var}, and can be extracted by \getPC \vSch.
%We call such configurations
%\emph{valid} configurations. The variational schema's presence condition 
%is the VDB feature model since it captures the relationship
%between features of the underlying application and their constraints,
%as explained in \secref{encode-var} and introduced as the VDB feature model. 
Hence, the variational schema defines all valid schema variants of a VDB. 
%\figref{vsch} concisely defines the formalization of variational schemas.
\exref{vsch} defines a variational schema for only a part of our motivating example introduced in \secref{mot} and
 \exref{vsch-mot} provides the variational schema of our motivating example in its entirety. 


\begin{example}
\label{eg:vsch}
$\vSch_1$ is the variational schema of a VDB that only includes relations \empacct\ and \ecourse\ in the last two rows
of both \tabref{mot-basic} and \tabref{mot-edu}. It has the
feature space 
\ensuremath{\fSet = \setDef{ \vFour, \vFive, \edu, \tFour, \tFive}}.
Note that attributes that exist conditionally are annotated with a feature expression
to account for such a condition, e.g., the \salary\ attribute only exists when \vFive\ = \t.
%
%\fModel_1 &= 
%\paran {\neg \edu \wedge \paran {\vFour \oplus \vFive} \wedge \neg \paran {\tFour \vee \tFive}
% }\\
%&\hspace{1pt}\vee
%\paran {\edu \wedge \paran {\vFour \oplus \vFive}
%\wedge
%\paran {\tFour \oplus \tFive}
%}
\begin{align*}
\vSch_1 &=
\{ \empacct ( \empno, \hiredate, \titleatt, \deptno, \annot [\vFive] \salary, 
 \annot [\edu] \isstudent,
\annot [\edu] \isteacher )^{\vFour \vee \vFive}\\
%
&\hspace{17pt}, \ecourse ( \cno, \cname, \annot [\tFive] \deptno )^{\tFour \vee \tFive} \}^{\dimMeta_1}\\
%\fModel_1 &= (\vFour\oplus\vFive) \wedge
%  ((\edu\wedge(\tFour\oplus\tFive)) \vee (\neg\edu\wedge\neg(\tFour\vee\tFive)))
\dimMeta_1 &= 
\paran {\neg \edu \wedge \oneof {\vFour, \vFive} \wedge \neg \paran {\tFour \vee \tFive}
 }
%&\hspace{1pt}
\vee
\paran {\edu \wedge \oneof {\vFour, \vFive}
\wedge
\oneof {\tFour, \tFive}}
\end{align*}
where \ensuremath{\dimMeta_1} allows only one temporal feature for the basic
schema to be enabled at a time, and either one temporal feature for the education
extension, if \edu\ is enabled, or else no temporal feature for the education
extension.
\end{example}

\input{formulas/vschConf}

%\textbf{Hierarchal structure of feature expressions in a variational schema:}
The presence of an attribute follows the hierarchal layout of information in a database:
an attribute's presence depends on the presence of its parent variational relation, which in turn 
depends on the presence of the variational schema. 
%relation presence condition and the feature model.
% presence of the variational schema. 
%
Thus, the complete presence condition of the attribute
$\annot[\dimMeta_\vAtt]{\vAtt}$ in variational relation
$\vRel\annot[\dimMeta_\vRel]{(\ldots)}$ defined in variational schema \vSch\
% with feature
%model \fModel\ 
is
$\getPCfrom{\vAtt}{\vSch}=\dimMeta_\vAtt\wedge\dimMeta_\vRel\wedge \getPC \vSch$.

%and it is present iff this presence condition is satisfiable, i.e., 
%\ensuremath{\sat {\getPCfrom \vAtt \vSch}}.
Similarly, the presence condition of variational relation $\vRel$ is
\ensuremath{\getPCfrom \vRel \vSch = \dimMeta_\vRel \wedge \getPC \vSch}.
For example, in \exref{vsch} we have
\ensuremath{\getPCfrom \empacct {\vSch_1} = (\vFour \vee \vFive) \wedge \dimMeta_1}.
%the conjunction of its \revised{annotation}
%%presence condition 
%with its variational relation's \revised{annotation}
%%presence condition
%and the feature model.
%
%Similarly,
%the presence condition of a variational relation is the conjunction of its
%\revised{annotation}
%%presence condition 
%and the feature model.
%%
%\revised{
%In other words, the annotated attribute \optAtt\ of variational relation 
%\ensuremath{\vRel \annot [\dimMeta_\vRel] {\left(\annot \vAtt, \ldots\right)}} 
%%with 
%%$\dimMeta_r = \getPC \vRel$
%defined in the variational schema \vSch\ with feature model \fModel\
%is valid if: $\sat {\getPCfrom \vAtt \vSch} = \sat {\dimMeta_\vAtt \wedge \dimMeta_r \wedge \fModel }$.}
Furthermore, a database element is only present in variants for
which its presence condition satisfiable, e.g., in \exref{vsch}
 the \isstudent\ attribute 
%described in \exref{vsch} 
%is present in the variants that make its presence condition 
%\ensuremath {\edu \wedge (\vFour \vee \vFive) \wedge \fModel_1 }
%satisfiable.
%So \isstudent\ 
is present in the variant 
\ensuremath{\setDef {\edu, \vFour, \tFive}} since 
\ensuremath{\fSem [\setDef {\edu, \vFour, \tFive}] {\getPCfrom \isstudent {\vSch_1}}
= \fSem [\setDef {\edu, \vFour, \tFive}] {\edu \wedge (\vFour \vee \vFive) \wedge \dimMeta_1}
= \t \wedge (\t \vee \f) \wedge ((\neg \t \wedge \oneof{\t, \f} \wedge \neg (\f \vee \t)) \vee (\t \wedge \oneof{\t, \f} \wedge \oneof{\f, \t})) = \t}
but it is not present in the variant
\ensuremath{\setDef{\vFour, \tFive}} since in this variant \edu = \f, thus,
\ensuremath{\fSem [\setDef {\edu, \vFour, \tFive}] {\getPCfrom \isstudent {\vSch_1}} = \f}.



%\subsubsection{Configuring a Variational Schema}
%\label{sec:conf-vsch}
Intuitively and similar to variational sets, a variational schema is a systematic  
compact representation of a set of plain schemas called variants.
%, e.g., SPL, that encodes 
%the variation effectively inside the database schema by means of 
%feature expressions.
%Consequently, variational schemas relieve the
%need to define an intermediate schema and state mappings 
%between it and source schemas, like the approach that 
%data integration systems employ. 
%One can still obtain the 
A schema variant can be obtained 
%A specific pure relational schema for
%a database variant can be obtained 
by \emph{configuring} the variational schema with that variant's configuration.
We define the configuration function for variational schemas and its elements in \figref{vsch}.
\exref{vsch-mot} illustrates configuring the variational schema of our motivating example
for the variant \setDef {\edu, \vTwo, \tThree}.
%For example, consider the variational schema in \exref{vsch}.
%Configuring the variational attribute set of the \empacct\ variational relation for 
%the variant \setDef {\vFive}, i.e., 
%\ensuremath {\olSem [\setDef {\vFive}] {\empno, \hiredate, \titleatt, \deptno, \annot [\vFive] \salary,
%\annot [\edu] \isstudent,
%\annot [\edu] \isteacher}},
%yields the 
%%relational 
%attribute set of
%\ensuremath {\setDef {\underline \empno,\underline \hiredate,\underline \titleatt,\underline \deptno }}.

\begin{example}
\label{eg:vsch-mot}
\tabref{mot-vsch} illustrates the variational schema of the motivating example, denoted by
$\vSch_\mot$. 
As a reminder the motivating example has the feature space $\fSet = \setDef {\edu,
\vOne, \vTwo, \vThree, \vFour, \vFive, \tOne, \tTwo, \tThree, \tFour, \tFive}$. Additionally,
all schema variants are illustrated in\tabref{mot}. 
\ensure{make sure encoding is correct in \tabref{mot-vsch}}
\input{tables/motVsch}

%\tabref{mot-vsch} provides the v-schema of our motivating example, given in \tabref{mot}.
The feature model $\dimMeta_\mot$ only allows one temporal feature to be true from a set of temporal features at the time. 
\begin{align*}
\dimMeta_\mot &= 
\left( 
\neg \edu \wedge \oneof{
\vOne, \vTwo, \vThree, \vFour, \vFive
}
\wedge \neg \left(\tOne \vee \tTwo \vee \tThree \vee \tFour \vee \tFive
 \right)
\right)\\
&\quad\vee 
\left( \edu \wedge \oneof{
\tOne, \tTwo, \tThree, \tFour, \tFive
} \wedge
\oneof{
\vOne, \vTwo, \vThree, \vFour, \vFive
} \right)
\end{align*}
%where \ensuremath{\fName_1 \oplus \fName_2 = (\fName_1 \wedge \neg \fName_2) \vee (\fName_2 \wedge \neg \fName_1)}.
\noindent
However, the feature model can be encoded differently. For example, $\VVal {\dimMeta_\mot}$ restrict 
it such that it only allows 
the two sets of temporal features to change together.
\begin{align*}
\VVal {\dimMeta_\mot} &= 
\mathit{oneof} (
\left( \vOne \vee \left(\vOne \wedge \edu \wedge \tOne \right) \right)
,
\left( \vTwo \vee \left(\vTwo \wedge \edu \wedge \tTwo \right) \right)
,
\left( \vThree \vee \left(\vThree \wedge \edu \wedge \tThree \right) \right)\\
&\qquad\qquad,
\left( \vFour \vee \left(\vFour \wedge \edu \wedge \tFour \right) \right)
,
\left( \vFive \vee \left(\vFive \wedge \edu \wedge \tFive \right) \right)
)
\end{align*}
%  to allow more than one temporal feature to be true at the time. 
%Hence, 
%\fModel\ is not the only v-schema capturing variation of the employee schema. 
\noindent
Hence, the feature model of a VDB can vary based on the relationship between 
features and the restrictions that they must follow.
Additionally, the encoding of presence condition can change since different feature 
expressions can be indicate the same set of variants.
For example, the presence condition of the \job\ relation can be changed to \ensuremath{\neg \vFive}. 

%
Configuring the variational schema $\vSch_\mot$ for the variant that only enables features
\edu, \vTwo, and \tThree\ (i.e., the variant \setDef {\edu, \vTwo, \tThree}) results in 
relations contained in the two yellow highlighted cells of tables in \tabref{mot}.
\end{example}

